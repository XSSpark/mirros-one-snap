name: mirros-one
version: "0.1.0"
summary: Just a test
description: Testing snap containers for mirr.OS one.
grade: stable
confinement: strict

apps:
  join-network:
    command: sh $SNAP/opt/join-network/bin/cmd.sh
    plugs: [network-manager]

  apache:
    command: run-httpd -k start -DFOREGROUND
    stop-command: httpd-wrapper -k stop
    daemon: simple
    restart-condition: always
    plugs: [network, network-bind, removable-media]

parts:
  cmd:
    source: .
    plugin: dump
    organize:
      cmd.sh: opt/join-network/bin/cmd.sh
  nmcli:
    plugin: nil
    stage-packages:
      - network-manager
    organize:
      usr/bin/nmcli: bin/nmcli

  apache:
    plugin: apache
    source: http://ftp.wayne.edu/apache/httpd/httpd-2.4.34.tar.bz2
    source-checksum: sha256/fa53c95631febb08a9de41fd2864cfff815cf62d9306723ab0d4b8d7aa1638f0

    # The built-in Apache modules to enable
    modules:
      - headers
      - proxy
      - proxy_fcgi
      - setenvif
      - env
      - rewrite
      - mime
      - dir
      - authz_core
      - unixd
      - alias
      - ssl
      - socache_shmcb

    filesets:
      exclude:
        - -man
        - -manual
        - -htdocs
        - -include
        - -build
        - -conf/httpd.conf
        - -conf/magic
        - -conf/original
        - -conf/extra
        - -bin/apachectl
        - -bin/envvars*
    stage:
      - $exclude
    prime:
      - $exclude
